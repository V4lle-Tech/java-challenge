<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout/main}">

<div layout:fragment="content">
    <!-- Header con botón de crear -->
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-900" th:text="${titulo}">Productos</h1>
        <a th:href="@{/products/new}"
            class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150 ease-in-out">
            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                    d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                    clip-rule="evenodd"></path>
            </svg>
            Nuevo Producto
        </a>
    </div>

    <!-- Verificar si hay productos -->
    <div th:if="${#lists.isEmpty(products)}" class="bg-blue-50 border border-blue-200 rounded-md p-4 mb-6">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd"
                        d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                        clip-rule="evenodd"></path>
                </svg>
            </div>
            <div class="ml-3">
                <p class="text-sm text-blue-700">
                    No hay productos disponibles.
                    <a th:href="@{/products/new}" class="font-medium underline text-blue-700 hover:text-blue-600">Crear
                        uno ahora</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Tabla de productos -->
    <div class="bg-white shadow overflow-hidden sm:rounded-md" th:unless="${#lists.isEmpty(products)}">
        <div class="px-4 py-5 sm:p-6">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ID</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Nombre</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Categoría</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Descripción</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Precio</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Stock</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Estado</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Acciones</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <!-- Iterar sobre la lista de productos -->
                        <tr th:each="product : ${products}" class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"
                                th:text="${product.id}">1</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <a th:href="@{/products/{id}(id=${product.id})}" th:text="${product.name}"
                                    class="text-indigo-600 hover:text-indigo-900 font-medium">
                                    Producto
                                </a>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span th:if="${product.category}" th:text="${product.category.name}"
                                    class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                    Sin categoría
                                </span>
                                <span th:unless="${product.category}" class="text-gray-500 text-sm">
                                    Sin categoría
                                </span>
                            </td>
                            <td class="px-6 py-4 text-sm text-gray-500">
                                <!-- Truncar descripción si es muy larga -->
                                <span th:text="${#strings.abbreviate(product.description, 50)}">
                                    Descripción
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                <!-- Formatear precio como moneda -->
                                <span th:text="${#numbers.formatCurrency(product.price)}">
                                    $0.00
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <!-- Badge con color según stock -->
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                                    th:classappend="${product.stock > 10} ? 'bg-green-100 text-green-800' : (${product.stock > 0} ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800')"
                                    th:text="${product.stock}">
                                    0
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <!-- Estado activo/inactivo -->
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                                    th:classappend="${product.active} ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'"
                                    th:text="${product.active} ? 'Activo' : 'Inactivo'">
                                    Activo
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                <div class="flex space-x-2">
                                    <!-- Ver detalle -->
                                    <a th:href="@{/products/{id}(id=${product.id})}"
                                        class="inline-flex items-center px-3 py-1 border border-transparent text-xs leading-4 font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                                        title="Ver">
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>
                                            <path fill-rule="evenodd"
                                                d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z"
                                                clip-rule="evenodd"></path>
                                        </svg>
                                    </a>
                                    <!-- Editar -->
                                    <a th:href="@{/products/{id}/edit(id=${product.id})}"
                                        class="inline-flex items-center px-3 py-1 border border-transparent text-xs leading-4 font-medium rounded-md text-yellow-700 bg-yellow-100 hover:bg-yellow-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500"
                                        title="Editar">
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                            <path
                                                d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z">
                                            </path>
                                        </svg>
                                    </a>
                                    <!-- Eliminar -->
                                    <button type="button"
                                        class="inline-flex items-center px-3 py-1 border border-transparent text-xs leading-4 font-medium rounded-md text-red-700 bg-red-100 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"
                                        title="Eliminar" onclick="openDeleteModal(this)"
                                        th:data-product-id="${product.id}" th:data-product-name="${product.name}">
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"
                                                clip-rule="evenodd"></path>
                                            <path fill-rule="evenodd"
                                                d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"
                                                clip-rule="evenodd"></path>
                                        </svg>
                                    </button>
                                </div>

                                <!-- Modal de confirmación de eliminación -->
                                <div class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"
                                    th:id="'deleteModal' + ${product.id}">
                                    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
                                        <div class="mt-3">
                                            <h3 class="text-lg font-medium text-gray-900 mb-4">Confirmar Eliminación
                                            </h3>
                                            <div class="mb-4">
                                                ¿Estás seguro de eliminar el producto
                                                <strong th:text="${product.name}" class="text-gray-900">?</strong>
                                            </div>
                                            <div class="flex justify-end space-x-3">
                                                <button type="button"
                                                    class="px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500"
                                                    onclick="closeDeleteModal(this)">
                                                    Cancelar
                                                </button>
                                                <form th:action="@{/products/{id}/delete(id=${product.id})}"
                                                    method="post" class="inline">
                                                    <button type="submit"
                                                        class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">
                                                        Eliminar
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Estadísticas -->
            <div class="mt-4 border-t border-gray-200 pt-4">
                <p class="text-sm text-gray-500">
                    Total de productos: <span class="font-medium text-gray-900"
                        th:text="${#lists.size(products)}">0</span>
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    function openDeleteModal(button) {
        const productId = button.getAttribute('data-product-id');
        const modal = document.getElementById('deleteModal' + productId);
        if (modal) {
            modal.classList.remove('hidden');
        }
    }

    function closeDeleteModal(button) {
        const modal = button.closest('[id^="deleteModal"]');
        if (modal) {
            modal.classList.add('hidden');
        }
    }
</script>

</html>